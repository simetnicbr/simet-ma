simet-ma (0.18.8+simetas1) unstable; urgency=medium

  * SIMET-AS variant
  * change download directory to not update to regular simet-ma.
  * include beta version of the top.nic.br/internet.nl client

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 04 Apr 2024 11:30:07 -0300

simet-ma (0.18.8) unstable; urgency=medium

  * simet-ma version 0.18.8
  * inetup: handle partial messages (not seen in the field)
  * inetup: fix several potential issues that would cause connection drops
  * sspoofer: add source address spoofing measurement client (sspooferc)
    * Add SPOOFER measurement support to simet-ma_run.sh.  Right now, it
      needs to be explicitly asked for (simet-ma_run.sh --test SPOOFER)
    * Add LMAP capability and task to run sspooferc directly
      (simet.nic.br_sspooferc) and through simet-ma_run.sh
      (simet.nic.br_spoofer-v2)
    * Run the SPOOFER measurement every 12 hours
  * deb: move libcap2-bin from "Recommends" to "Depends"
  * deb: grant CAP_NET_RAW to sspooferc (requires libcap2-bin)
  * Remove remnants of the previous simet_spoofer / simet_bcp38 measurement

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 04 Apr 2024 11:25:40 -0300

simet-ma (0.18.7) unstable; urgency=medium

  * simet-ma version 0.18.7
  * Depends on simet-lmapd 0.15.3 or later
    * -c+ CLI option support on lmapd, lmapctl
    * built-in config_path without /var/run/lmapd/lmap-schedule.json
  * deb, simet-api: support multiple instances of simet-lmapd
    Not for SIMETBox yet
  * deb: add several failsafes to find, chmod and chown calls, mostly
    to safeguard against missing configuration

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 29 Feb 2024 20:14:27 -0300

simet-ma (0.18.6.4) unstable; urgency=medium

  * simet-ma version 0.18.6.4
  * simet-api: simet_lmap-fetch_schedule: ensure schedule file will be
    group-writeable
  * simet-api: simet_register_ma.sh: fix filesystem permissions for
    LMAP_AGENT_FILE (harmless) and /var/run/simet_public
  * deb: simet-ma.init, simet-lmapd.init: correct the filesystem permissions
    of several objects

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 02 Feb 2024 15:34:40 -0300

simet-ma (0.18.6.3) unstable; urgency=medium

  * simet-ma version 0.18.6.3
  * simet_gen_vlabel: use PBKDF2-HMAC-SHA2 for "N0 format"
  * simet_gen_vlabel: remove base64safe padding from vlabel

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 31 Jan 2024 13:04:13 -0300

simet-ma (0.18.6.2) unstable; urgency=medium

  * simet-ma version 0.18.6.2
  * Add simet_gen_vlabel to generate "N0 format" virtual labels
  * Add SVG support to simet_qrcode.sh, for OpenWRT use, and ship it
    in SIMETBox builds.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 24 Jan 2024 14:45:28 -0300

simet-ma (0.18.6.1) unstable; urgency=medium

  * simet-ma version 0.18.6.1
  * deb: provide hook for dhcpdc (dhclient), pppd
    Add hook for dhcpdc (dhclient) and pppd with the same functionality as
    the already provided ones for NetworkManager, networkd-dispatcherd and
    ifupdown (refer to simet-ma 0.18.5.1).

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 21 Dec 2023 15:35:00 -0300

simet-ma (0.18.6) unstable; urgency=medium

  * simet-ma version 0.18.6
  * simet-runner: retrieve measurement profiles when available
  * simet-runner: use the median RTT from TWAMP to select the
    TCPBW measurement parameters from a measurement profile
  * simet-runner: use simet_lib.sh
  * simet-runner: send User-Agent header on all http requests

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 19 Dec 2023 15:04:59 -0300

simet-ma (0.18.5.1) unstable; urgency=medium

  * simet-ma version 0.18.5.1
  * simet-api: simet_register_ma: clean up temp files on exit due to signals
  * simet-api: simet_register_ma: set umask to 0002
  * simet-api: minor documentation updates
  * simet-api: lastrun timestamp for simet_register_ma.sh --boot
    Run only once every 24H when in "--boot" mode
  * deb: run simet_register_ma.sh as user nicbr-simet in daily cronjob.
    The daily cronjob would run simet_register_ma.sh as the root user, which
    is undesireable for many reasons
  * deb: simet-ma.init: fix file ownership and permissions at start.
  * deb: hook simet-register-ma to network state dispatchers
    Try to ensure simet-register-ma will have a chance to run when network
    goes online.  Add hooks for Debian-style ifupdown (if-up), Network Manager
    (online), systemd-networkd (routable).
  * deb: start measurement engine on network state dispatcher hooks
    This needs to be done to bring up "inetup" when we switch from a "no
    registration information" -- in which case "inetup" fails to start -- to
    "registered", but it might be required on other cases as well.  If you
    want to stop the measurement engine, disable it properly using the
    initscripts layer (service X disable / systemctl mask X).
  * simet-api: simet_register_ma: delay simet-lmapd reload to EXIT
  * lmap: add simet.nic.br_register task/capability
  * deb: control: add pre-depends on dh's misc:Pre-Depends substvar

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 18 Dec 2023 14:53:35 -0300

simet-ma (0.18.5) unstable; urgency=medium

  * simet-ma version 0.18.5
  * tcpbw: early-free JSON report data structures
  * tcpbw: add sampling control, and extended performance sampling
    * Add CLI option -s to adjust the base sampling period (default 500ms)
    * Add CLI option -S to enable tcp_info sampling (expensive)
    * Add CLI option -O to enable and output json data with the per-stream
      data samples, socket buffer state (skmem), and per-stream TCP state
  * tcpbw: MSS awareness, enable TCP_CORK mode
  * tcpbw: RTT awareness: delay stream start-of-transmission
    Delay the start of the data transmission on each measurement stream
    using a stair pattern, where just one stream starts transmitting data at
    first, and then other streams start transmitting one by one, separated
    by a configurable delay
  * tcpbw: implement kernel-assisted tcp pacing control (disabled by default)
  * simet-runner: silence errors from curl in task_discovery.sh
  * tcpbw: change default number of streams to 6
  * tcpbw: early exit if peer closes every stream
  * tcpbw: abort measurement on measurement connection fail
  * tcpbw: default IO size changed to 1MiB

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 08 Dec 2023 11:17:19 -0300

simet-ma (0.18.4.5) unstable; urgency=medium

  * simet-ma version 0.18.4.5
  * tcpbw: use the default automatic socket buffer limit
  * deb: increase system socket buffer size limits

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 04 Dec 2023 15:43:01 -0300

simet-ma (0.18.4.4) unstable; urgency=medium

  * simet-ma version 0.18.4.4
  * simet-api: simetbox: local measurement periodicty configuration fixes
  * simet-api: remove local schedule remants of fping-to-ixbr
  * simet-runner: discover_init() errorpath fixes

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 28 Nov 2023 17:08:28 -0300

simet-ma (0.18.4.3) unstable; urgency=medium

  * simet-ma version 0.18.4.3
  * simet-api: detect pairing status even without a vlabel
  * simet-api: handle MA transitioning to unpaired
  * deb: simet-ma.cron.weekly: update all simet* packages
    Use dpkg-query to find all installed simet* packages (which includes the
    new simetbox-deb* series of packages), and update them all.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 10 Oct 2023 11:34:19 -0300

simet-ma (0.18.4.2) unstable; urgency=medium

  * simet-ma version 0.18.4.2
  * simet-api: update interactive pairing URL for QRcode and /etc/issue
  * tcpbw: avoid double slashs when composing URLs.
  * tcpbw: fix benign leaks to avoid false-postives from valgrind
  * tcpbw: report aborted measurement as errors, not as warnings.
  * simet-api: support simet_get_mac_address.sh, simet_get_model.sh.
    Note that we do not provide a default simet_get_mac_address.sh or
    simet_get_device_model.sh outside of SIMETBox.  They are provided by
    vendor-specific or platform-specific supplementary packages.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 04 Oct 2023 14:25:35 -0300

simet-ma (0.18.4.1) unstable; urgency=medium

  * simet-ma version 0.18.4.1
  * simet-api: add QRcode and /etc/issue generators
    Inactive by default, you have to explicitly call the scripts.
    Requires package "qrencode" to work (added to Suggests).
  * simet-api: hook support for simet_create_vlabel (non-OpenWRT version)
  * tcpbw: update request/session API call to use & as the field-separator
  * debian: move simet_create_vlabel call from postinst to initscript

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 27 Jun 2023 08:28:50 -0300

simet-ma (0.18.4) unstable; urgency=medium

  * simet-ma version 0.18.4
  * simet-api: remove fping-to-ixbr measurement
  * tcpbw: use uncompressible payloads by default (not on SIMETBox)
  * debian: attempt to update the simet-ma and simet-lmapd packages in
    cron.weekly, regardless of automated-upgrades.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 15 Jun 2023 14:46:01 -0300

simet-ma (0.18.3.1) unstable; urgency=medium

  * simet-ma version 0.18.3.1
  * simet-runner: remove harmless left-over call to _report_servicelist_output.
  * simet-runner: avoid failing the entire latency-based peer selection
    process when there is no global IPv6 connectivity, but IPv6 packets were
    sucessfully sent.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 30 May 2023 13:52:43 -0300

simet-ma (0.18.3) unstable; urgency=medium

  * simet-ma version 0.18.3
  * simet-runner: shorten max-wait for API calls to 15s
  * simet-runner: change how latency-based server selection orders
    peers to not reorder across Service List peer groups.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 25 May 2023 08:48:30 -0300

simet-ma (0.18.2) unstable; urgency=medium

  * simet-ma version 0.18.2
  * twamp: fix issue introduced in 0.18.0 that resulted in early termination
    of the receive thread, and a false report of dropped (lost) packets.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 23 May 2023 08:36:30 -0300

simet-ma (0.18.1.1) unstable; urgency=medium

  * simet-ma version 0.18.1.1
  * source: modernize C support in autotools.
  * source: unbreak openwrt 15 build.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 18 May 2023 14:55:14 -0300

simet-ma (0.18.1) unstable; urgency=medium

  * simet-ma version 0.18.1
  * twamp: send test packets with TTL 255.
    The RFCs mandate for a TTL of 255 when sending TWAMP/OWAMP-TEST packets,
    and STAMP doesn't say anything.  Use TTL 255 by default on TEST packets.
  * twamp: major code refactoring, many minor fixes and warning removals
  * twamp: add twamp-light support with SIMET extensions
  * twamp: add measurement summary report
  * simet-runner: limit wait for server-monitor reply
    Limit attempts to talk to each location's server-monitor to 15s for TCP
    connect, and 30s for API reply.
  * simet-runner: add network-RTT (latency) based server selection
    Measure RTT to the candidate servers using TWAMP-light and few
    packets.  Skip servers that don't reply, and order the resulting set
    by median RTT.
  * deb: update APT repository keys.
  * inetup: silence harmless warning.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 16 May 2023 12:16:46 -0300

simet-ma (0.18.0) unstable; urgency=medium

  * simet-ma version 0.18.0
  * twamp: code cleanups and minor refactoring
  * twamp: restore MSG_TRUNC for recv() to better detect invalid packets
  * twamp: implement configurable payload size
    Add the -s option to configure the payload size.  We accept payload
    sizes 128 to 65400 in the client, however the server will impose its
    own limits
  * twamp: implement RFC6038 symmetric mode
    Request symmetric mode from the server (if it offers that option).
    This client has always required it, and both perfSonar and SIMET2
    TWAMP servers/reflectors always operate in symmetric mode.  If the
    server ignores the twamp option, output an warning but try the
    measurement anyway, as it will likely succeed.
  * twamp: add twamp-light mode (experimental).
  * twamp: implement source address binding for twamp-light.
  * twamp: abort measurement on too many message_send() errors
  * twamp: finish measurement early when a fatal error happens
  * twamp: finish measurement early when only corrupt packets are received
    This is important for twamp-light in unauthenticated mode.
  * twamp: change systematic send error into jitter
    Switch to (where available) clock_nanosleep() with TIMER_ABSTIME, which
    changes some of the the systematic error we had on the packet send
    schedule (always a bit more than the desired interval, thus further
    deviating from the desired packet train) into sending jitter.
    With this change, it is possible for the interpacket delay in the packet
    train to be a bit less than the desired target, instead of always being
    a bit more than the desired target.
  * twamp: round to nearest when converting to/from ntp-v3 timestamps
  * tcpbw: code cleanups and minor refactoring
  * tcpbw: LFN support
    + use highest socket buffer size as a hint for send()/recv() size
    + try to request very large socket buffers (on non-SIMETBox builds)
      Ask for 32MiB worth of send and receive socket buffers before connect,
      so that TCP window scale can handle LFNs (think 100Mbps @ 500ms RTT).
      Otherwise, the number of concurrent connections required to saturate
      a LFN (high-bandwidth, high-delay network) is too high.  Also helps
      with large-throughput low-delay networks.
  * tcpbw: increase the limit for concurrent connections in the client.
    The server will impose its own limits, though.
  * tcpbw: properly detect recv() errors during download measurement
    Abort download measurement on recv() errors, instead of generating an
    erroneus report with spurious *very* large spikes.  Note that this
    kind of misbehavior is detected by the SIMET2 data pipeline, so such
    measurements have always been discarded by SIMET2.
  * tcpbw: during download measurement, fully drain stream before going for
    the next one.  This improves throughput on LFNs.
  * tcpbw: address several warnings, fixing a few potential issues
  * tcpbw: refactor sampling loops
    + Improve receive sampling control, it is now far more stable and
      accurate
    + Avoid a pontential sampling error related to very low reception
      rates and data arriving *only* just at the beginning of the sampling
      window.
    + Use CLOCK_MONOTONIC instead of CLOCK_REALTIME for sampling control
  * simet-runner: tcpbw: enable very verbose output in --debug mode

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 14 Feb 2023 15:03:22 -0300

simet-ma (0.17.9.4) unstable; urgency=medium

  * simet-ma version 0.17.9.4
  * simetbox: fix vlabel generation for some devices with UBIFS, and also
    ignore the "factory" partition on Ubiquiti devices (needed on ubnt-erx).

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 03 Feb 2023 13:59:27 -0300

simet-ma (0.17.9.3) unstable; urgency=medium

  * simet-ma version 0.17.9.3
  * inetup: fix double-free on error path
  * inetup: avoid SIGSEGV with 64-bit time_t on 32-bit
  * simet-api: simetbox: reload lmapd through lmapctl, instead of initscript

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 26 Jan 2023 15:40:39 -0300

simet-ma (0.17.9.2) unstable; urgency=medium

  * simet-ma version 0.17.9.2
  * twampc: really implement connection timeout cli parameter
  * inetup: several minor fixes
  * inetup: tcpaq refactoring

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 24 Nov 2022 20:33:32 -0300

simet-ma (0.17.9.1) unstable; urgency=medium

  * simet-ma version 0.17.9.1
  * simet-api: retrieve, cache and log participant info.
  * simet-api: fix typo in comments, overidable to overridable
  * simet-api: simet_register_ma: update metadata explicitly

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 06 Jun 2022 13:27:45 -0300

simet-ma (0.17.9) unstable; urgency=medium

  * simet-ma version 0.17.9
  * twamp: send a SID cookie inside TWAMP_TEST packets, in order to be able to
    preserve one-way packet loss measurement even through NAT that maps UDP
    and TCP flows with the same origin and destination to different public IP
    addresses.  This is a non-standard SIMET2 extension to TWAMP.
  * twamp: refactor send and receive processing, to better cope with
    malformed messages.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 03 Jun 2022 09:11:42 -0300

simet-ma (0.17.8.3) unstable; urgency=medium

  * simet-ma version 0.17.8.3
  * simet-api: some make dist and make clean fixes
  * simet-api: silence a few shellcheck warnings
  * simet-api: fix simet_lib::simet_jo_quoted for empty input
    Note: this bug would not be triggered in production before 0.17.9.
  * simet-api: simet_lib{_config}: protect stdin, stdout
  * simet-api: do not close stdin, causes breakage with recent libuv
  * simet-runner: do not close stdin
  * debian: postinst: do not call into simet-api with stdin closed

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 24 May 2022 15:27:39 -0300

simet-ma (0.17.8.2) unstable; urgency=medium

  * simet-ma version 0.17.8.2
  * simet-runner: rework agent-info metric to match the LMAP one
  * deb: force xz compression for binary packages (avoid zstd for now)
  * deb: unattended-upgrades: fix for distro derivatives
  * simet-api: fix xdg-open call on simet_view_results.sh

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 13 Mar 2022 19:43:16 -0300

simet-ma (0.17.8.1) unstable; urgency=medium

  * simet-ma version 0.17.8.1
  * simet-api: add vlabel platform-vendor API (SIMETBOX)

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 08 Dec 2021 16:27:13 -0300

simet-ma (0.17.8) unstable; urgency=medium

  * simet-ma version 0.17.8
  * simet-api: guard against SIGTERM on lmapd reload
  * simet-api: send MA description, hostname when registering
  * simet-api: send firmware_version and device_model when registering
  * simet-api: fix JSON quoting on simet2-agent-info, simet_register_ma
  * lmap-tasks: add firmware_vendor and device_model to agent-info
  * simet-api: simetbox: rework agent environment information and agent-info

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 23 Nov 2021 12:36:00 -0300

simet-ma (0.17.7.1) unstable; urgency=medium

  * simet-ma version 0.17.7.1
  * simet-api: introduce an emergency schedule for resiliency.  It doesn't do
    measurements: it just tries to flush report queues and fetch the proper
    schedule.
  * deb: use the emergency schedule while the locally generated, or remotely
    provided schedule are not yet in place.
  * deb: try harder to ensure user nicbr-simet owns the schedule file.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 17 Nov 2021 15:04:16 -0300

simet-ma (0.17.7) unstable; urgency=medium

  * simet-ma version 0.17.7
  * simet-api: include simet_view_results.sh on SIMETBox builds
  * simet-api: add --lang parameter to simet_view_results.sh
  * simet-api: handle LANGUAGE properly for simet_view_results.sh

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 12 Nov 2021 20:00:46 -0300

simet-ma (0.17.6.7) unstable; urgency=medium

  * simet-ma version 0.17.6.7
  * deb: try much harder to stop lmapd when we stop the service
  * deb: ensure lmapd is not running during package configuration

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 07 Oct 2021 11:47:43 -0300

simet-ma (0.17.6.6) unstable; urgency=medium

  * simet-ma version 0.17.6.6
  * geolocation: allow easy configuration of the cache longevity
  * geolocation: add random-spread to cache longevity control
  * geolocation: persist cached location across reboots
  * simet-runner: cleanup temporary files on failure paths (in non-debug mode)

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 06 Oct 2021 12:18:02 -0300

simet-ma (0.17.6.5) unstable; urgency=medium

  * simet-ma version 0.17.6.5
  * Add workaround for Let's Encrypt trust chains being rejected by
    old gnutls and old openssl after "DST Root CA X3" expires in 2021-09-30
  * COPYING: remove an stray non-ascii character
  * debian/control: build-depend on automake

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sat, 25 Sep 2021 21:54:02 -0300

simet-ma (0.17.6.4) unstable; urgency=medium

  * simet-ma version 0.17.6.4
  * inetup: wait for MA_CONFIG explicitly in state machine
  * inetup: suppress sequence numbers when uneeded: stop sending them
    after CONNECT if server does not echo back (enable) the capability
    in the connection.
  * inetup: suppress unwanted MEASUREMENT messages: do not send MEASUREMENT
    (telemetry) messages if the server does not enable the capability in the
    connection.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 14 Jun 2021 10:41:22 -0300

simet-ma (0.17.6.3) unstable; urgency=medium

  * simet-ma version 0.17.6.3
  * inetup: support sequence numbers, protocol capability "client-seqnum-v1":
    add 32-bit sequence numbers to most messages, helps syncronizing messages
    delivered in a multi-peer multi-cluster scenario.
  * inetup: support boot-time timestamps, protocol capability
    "timestamp-zero-at-boot": a client-timestamp of 0s is system boot time
    (as opposed to some undefined point in time) when this capability is
    present in the client CONNECT message.
  * inetup: correct timestamp field names for MEASUREMENT messages
  * inetup: correct CLI help message for option "-i"

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 10 Jun 2021 15:13:39 -0300

simet-ma (0.17.6.2) unstable; urgency=medium

  * simet-ma version 0.17.6.2
  * inetup: support multiple measurement peer clusters on the command line,
    and try to keep a connection open to one ipv4 and one ipv6 peer for each
    cluster.
  * inetup: switch to non-blocking, concurrent TCP connect()
  * inetup: record (and log) new measurement peer metadata:
    server description, server hostname, cluster hostname, and uptime group.
  * inetup: fix minor memory leak when reconnecting to a measurement peer

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 26 May 2021 10:18:47 -0300

simet-ma (0.17.5) unstable; urgency=medium

  * simet-ma version 0.17.5
  * simet_spoofer: don't tracefilter in parallel
  * simet_spoofer: wait 5s between tracefilter runs (we do 3 runs)
  * simet_spoofer: wait 5s between tracefilter probes

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 23 Apr 2021 12:38:40 -0300

simet-ma (0.17.4) unstable; urgency=medium

  * simet-ma version 0.17.4
  * inetup: source cleanups (no runtime changes)
  * jsonpath: fix non-openwrt build on systems with a newer gcc, by
    updating embedded libubox

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 15 Apr 2021 14:29:42 -0300

simet-ma (0.17.3) unstable; urgency=medium

  * simet-ma version 0.17.3
  * simet-spoofer: reenable use of multiple private origin addresses

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 22 Mar 2021 11:53:17 -0300

simet-ma (0.17.2) unstable; urgency=medium

  * simet-ma version 0.17.2
  * Fix building with a set --prefix

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 08 Mar 2021 16:52:01 -0300

simet-ma (0.17.1) unstable; urgency=medium

  * simet-ma version 0.17.1
  * twamp, tcpbw: add -o option to redirect output
  * twamp: suppress empty reports unless we actually transmitted data

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 01 Feb 2021 20:02:25 -0300

simet-ma (0.17.0) unstable; urgency=medium

  * simet-ma version 0.17.0
  * simet_spoofer: do not spoof origin = destination
  * deb: add a comment to the /etc/cron.d/simet-ma autogenerated file
    (affects only new installs for now)
  * simet-api: correctness fixes for simet_lib.sh invocation
  * simet-api,deb: simet_lib*: defend against config syntax errors
  * simet-api: geolocation: parse command-line earlier
  * simet-api: geolocation: disabled-mode corrections
  * simet-api,simet-runner: cleanup when interrupted:
    When lmapd suppresses a schedule/action or when it is stopped, it will
    send the TERM signal to running actions/tasks.  Trap SIGQUIT, SIGTERM and
    SIGINT and remove incomplete output data before exiting due to such
    signals.  For simet-runner, leave behind the temporary files untouched in
    debug mode.
  * deb: depend on simet-lmapd with resilient lmapctl report (>= 0.15.0~)
  * simet-api: add report queue subsystem
  * simet-api,simet-runner: use the report queue on runner
  * simet-api: remove unsent reports when low on resources
    If we're low on resources (defined as free filesystem space in the
    filesytem hosting the report queue directory for the moment, and
    "MemFree" RAM if a tmpfs is detected in Linux), remove unsent reports
    until we have freed enough resources
  * simet-api: more control for report submission queues:
    Add CLI options to simet_lmap-send-report to bypass queueing or sending of
    a report, and to give up faster when the LMAP report collector is slow to
    respond.  Add a CLI option to give up faster on the LMAP report collector
    to simet_report-queue-flush.sh, for parity with simet_lmap-send-report.sh.
    Change the LMAP task configuration for "simet.nic.br_report" to not wait
    too much for the LMAP report collector (and queue the report for later
    transmission, instead).
  * simet-api: try to send reports more often (SIMETBox)

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 17 Jan 2021 21:19:01 -0300

simet-ma (0.16.16.2) unstable; urgency=medium

  * simet-ma version 0.16.16.2
  * simet-spoofer: fix --key and direct target specification in CLI

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 30 Nov 2020 18:00:13 -0300

simet-ma (0.16.16.1) unstable; urgency=medium

  * simet-ma version 0.16.16.1
  * simet-runner: prefix measurement peer names with ipv4/ipv6.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 26 Nov 2020 12:03:23 -0300

simet-ma (0.16.16) unstable; urgency=medium

  * simet-ma version 0.16.16
  * simet-spoofer: enable the bcp38 spoofed origin measurement every 12h.
    This is a preliminary (beta) version of this measurement.  It sends normal
    packets as well as packets with spoofed *origin* address to specific
    NIC.br servers, and attempts to detect the filtering point (Robert Beverly
    and Steven Bauer; Tracefilter: A Tool for Locating Network Source Address
    Validation Filters).  It is similar in intent to CAIDA Spoofer, but with a
    very different implementation and set of "vantage points" (target
    servers).

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 15 Nov 2020 19:14:05 -0300

simet-ma (0.16.15) unstable; urgency=medium

  * simet-ma version 0.16.15
  * simet-api: add new script, simet_view_reports.sh, which either shows the
    URL (simet_view_reports.sh --url) or calls the xdg browser to show the
    measurement report dashboard for the MA.
  * deb: ship a freedesktop.org menu item that uses simet_view_reports.sh to
    open the measurement results in a webpage using the default web browser.
  * simet-api: allow docker containers to disable geolocalization measurements
    properly, for SIMET-AS use.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 05 Nov 2020 14:44:30 -0300

simet-ma (0.16.14) unstable; urgency=medium

  * simet-ma version 0.16.14
  * simet-api: generate the schedule locally using a configurable
    measurement period for the main group of SIMET measurements, and
    ping-to-gateway.  Any schedule received from the LMAP controller
    will override this, though.
  * simet-api: better spread the measurements throughout the fleet
    even when the LMAP controller is down
  * twamp: use CLOCK_MONOTONIC for measurements.  This avoids rare
    measurement artifacts due to ntp/chrony/sysadmin stepping
    the clock.
  * simet-api: lmap: add simet_nic.br_fping-to-ixbr measurement, run
    it every 12h
  * simet-api: move ping-to-gateway scripts to lmap-tasks/ in source,
    and to lmapbindir on binaries, since it is only run from an lmapd
    context.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 22 Oct 2020 13:49:48 -0300

simet-ma (0.16.13) unstable; urgency=medium

  * simet-ma version 0.16.13
  * simet-api: add preliminary version of simet_spoofer, a BCP38 validation
    measuremet which tries to detect the (desired!) presence of protections
    against traffic with spoofed origin addresses.  Note that this requires
    simet-nping, a forked variant of nping(TM) from nmap(TM), to work.  The
    simet-nping fork is a work-in-progress that changes nping echo-mode to be
    more suitable for *this specific measurement use*, and it is likely not
    acceptable upstream.  NOTE: THIS NEW MEASUREMENT IS NOT INSTALLED BY
    DEFAULT, the measurement peers (servers) it needs are not yet available
    for general service.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 13 Sep 2020 18:06:04 -0300

simet-ma (0.16.12.1) unstable; urgency=medium

  * simet-ma version 0.16.12.1
  * deb: drop inetutils-* from Recommends
  * deb: version traceroute dependency, to bypass "provides: traceroute"
    from inetutils-traceroute
  * simet-api: prefer traceroute.db over traceroute, as
    the alternatives system from Debian/Ubuntu might be set
    to inetutils-traceroute.
  * simet-api: use /bin/bash for simet_register_ma.sh

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 13 Sep 2020 17:59:07 -0300

simet-ma (0.16.12) unstable; urgency=medium

  * simet-ma version 0.16.12
  * simet-api: add context metrics to simetbox_fping-to-gateway
    measurements

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 06 Sep 2020 15:15:56 -0300

simet-ma (0.16.11) unstable; urgency=medium

  * simet-ma version 0.16.11
  * simet-api: rename the generic fping metric
  * simet-api: add simetbox_fping-to-gateway measurement
    (SIMETBox only, OWRT 18.06+, for now), and call it
    every 1h on the default schedule
  * simet-runner: minor improvements to logging to console
  * simet-runner: TWAMPFAST traceroutes in background/parallel
  * simet-runner: enable reverse DNS in traceroute output

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 24 Aug 2020 09:51:45 -0300

simet-ma (0.16.10) unstable; urgency=medium

  * simet-ma version 0.16.10
  * simet-api: support cloning detection (active on simetbox)
  * simet-api: invalidade creds on status 410 (Agent Registry)
  * simet-api: vlabel anti-clonning support (for simetbox)
  * simet-api: change vlabel on-storage format (for simetbox)
  * simet-api: layerize credential writing, now hook-able
  * simet-api: properly call write_lmap_agent to have hook support
  * inetup: implement wan_txrx measurement (number of bytes sent and
    received on WAN interface, five-minute-average WAN throughput)
  * inetup: implement telemetry server selection, and MSG_MEASUREMENT
  * inetup: support MSG_DISCONNECT from server
  * inetup: fix possible memory leak when reloading configuration
  * inetup: several warning fixes
  * inetup: rework timer_check to avoid (extremely unlikely) overflow

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 09 Jul 2020 14:57:21 -0300

simet-ma (0.16.9) unstable; urgency=medium

  * simet-ma version 0.16.9
  * simet-api: simet-register-ma: force umask 0022, corrects issue
    on SIMETBox/OpenWRT rpcd, which sets too restrictive an umask

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 04 Jun 2020 23:18:53 -0300

simet-ma (0.16.8) unstable; urgency=medium

  * simet-ma version 0.16.8
  * simet-runner: fix sending of large reports to collector
  * simet-runner: add log_warn(), fixes IPv6 TCPBW error path
  * simet-runner: add new all-serverlist-MPs latency measurement
  * simet-runner: record in report the list of MPs received from SIMET2
  * simet-api: run the new all-serverlist-MPs latency measurement after the
    basic measurement finishes in the default LMAP schedule
  * simet-api: fix the LMAP tool wrapping for fping
  * docker: do not use --rm and --restart at the same time

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 08 May 2020 10:15:43 -0300

simet-ma (0.16.7) unstable; urgency=medium

  * simet-ma version 0.16.7
  * deb: use "NIC.br SIMET Team" as the maintainer name
  * deb, docker: install libcap2-bin (for setcap, getcap)
  * deb, docker: force CAP_NET_RAW+ep on system traceroute,
    ICMP traceroute needs this
  * simet-api: teach simet-runner to find simet_geolocation.sh
    when it is not on path
  * simet-runner: properly abort when unregistered

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sat, 25 Apr 2020 18:12:33 -0300

simet-ma (0.16.6) unstable; urgency=medium

  * simet-ma version 0.16.6
  * simet-runner: change twamp, tcpbw LMAP report action names
    and add an ICMP traceroute to complement TWAMP measurements
  * simet-runner: implement AGENT_LOCK and add --lock, --no-lock
    options to simet-ma_run.sh.
  * simet-api: rework locking, move locks to /var/lock/simet/

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 21 Apr 2020 23:22:42 -0300

simet-ma (0.16.5) unstable; urgency=medium

  * simet-ma version 0.16.5
  * simet_register_ma: retrieve the view_results token (VTK) and store it.
    The MA's UI will need this token to retrieve SIMET2 measurement results.
  * docker: restore the $0.hook functionality, it is really useful to
    variants.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sat, 04 Apr 2020 22:04:06 -0300

simet-ma (0.16.4) unstable; urgency=medium

  * simet-ma version 0.16.4
  * simet-runner: ignore empty/whitespace JSON, fixes measurement
    failure reports
  * deb: simet-ma.init: avoid start-stop-daemon --exec on start,
    it is incompatible with unpriv containers (CAP_SYS_ADMIN)
  * deb: simet-ma.init: fix status action
  * docker: add the simet-ma version file to the container
  * docker: disable unattended-upgrades of distro packages *after*
    an initial update at container start.  We can't trust service
    reload/restart without CAP_SYS_ADMIN to always work
  * docker: die every 15 days (to force restart, and get updates)
  * docker: redirect syslog to docker stdout/stderr
  * inetup: use files to get agent-id and token (CLI API CHANGE)
  * inetup: reload agent-id and token on SIGHUP
  * deb: simet-ma.init: implement reload and show simet-lmapd reload
  * deb: remove cronjob that was causing measurements to be run twice
  * simet-ma: remove simet-ma_periodic.sh
  * simet-api: implement lib/simet/simet_lib_config.sh
  * simet-api: consolidate config and hook loading
  * deb: use simet_lib_config.sh where simet-ma config is required
  * simet-api: implement lib/simet/conf.d/*.conf
  * simet-api: implement lib/simet/conf.d/*.hook
  * simet-runner: log to syslog
  * simet-ma: several log message/verbosity changes to everything
  * docker: refactor foreground runner and run inetup as a service,
    this fixes token/agent-id change and simet-ma package updates
  * docker: add policy-rc.d to support simet-ma,lmapd package updates
    properly
  * docker: document better the need for CAP_NET_ADMIN, CAP_NET_RAW,
    and --restart

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sat, 14 Mar 2020 16:08:51 -0300

simet-ma (0.16.3) unstable; urgency=medium

  * simet-ma version 0.16.3
  * simet_register_ma: add missing fields (from agent-info metric)
    to MA register procedure.  They were already sent when measuring.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 19 Feb 2020 14:31:00 -0300

simet-ma (0.16.2) unstable; urgency=medium

  * simet-ma version 0.16.2
  * twamp: rework error paths and debug messages

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 28 Jan 2020 14:39:11 -0300

simet-ma (0.16.1) unstable; urgency=medium

  * simet-ma version 0.16.1
  * twamp: remove per-packet discarding due to timeout (except
    for last packet in the packet train)
  * twamp, tcpbw: output lmap result table boilerplate to stdout even
    when aborting the test, except for initialization and parameter
    errors
  * simet-runner: preserve twamp, tcpbw stdout output even when their
    return status is non-zero, and in that case also add the stderr
    output to the report.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 16 Jan 2020 13:46:37 -0300

simet-ma (0.15.7) unstable; urgency=medium

  * simet-ma version 0.15.7
  * docker: document the need for CAP_NET_RAW, CAP_NET_ADMIN
  * docker: create /var/run/simet for geolocation cache
  * geolocation: fix mawk compatibility
  * geolocation: periodically run as root

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 10 Dec 2019 12:35:00 -0300

simet-ma (0.15.6) unstable; urgency=medium

  * simet-ma version 0.15.6
  * SIMETBOX: register the MAC address along the agent-id
    to aid user support and preseeded MA grouping

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 09 Dec 2019 23:48:58 -0300

simet-ma (0.15.5) unstable; urgency=medium

  * simet-ma version 0.15.5
  * docker: ensure file onwership is correct in persistent volume

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 03 Dec 2019 14:26:32 -0300

simet-ma (0.15.4) unstable; urgency=medium

  * simet-ma version 0.15.4
  * docker: documentation updates
  * docker: use Debian 10 "buster" on simet-ma container
  * twamp: handle exactly 2x packet duplication properly
  * tcpbw: be stricter about test duration and sample timing
  * tcpbw: zero-copy discard during downloads using MSG_TRUNC
  * deb: initscript fixes

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Sun, 01 Dec 2019 16:40:24 -0300

simet-ma (0.15.3) unstable; urgency=medium

  * simet-ma version 0.15.3
  * debian/control: depend on lsb-base for initscripts
  * simet-lmapd.init, simet-ma.init: several fixes
  * simet-lmapd.init, simet-ma.init avoid start-stop-daemon --exec
    to better support containers for now (--exec requires CAP_SYS_ADMIN)
  * lmap: add some tags to help detect backend routing issues
  * lmap: add subsystem-id tags to differentiate from simet-as, simet-ix
  * lmap: add peer-name tags for better backend compatibility
  * lmap: change the traceroute metric to an specific one
  * docker: cleanly terminate inetup and lmapd on container stop
  * docker: clean before build

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 22 Nov 2019 14:00:26 -0300

simet-ma (0.15.2) unstable; urgency=medium

  * simet-ma version 0.15.2
  * twampc, tcpbwc: add -r option for simet-lmapd compatibility
    since simet-lmapd and simet-runner have different output
    format requirements at the moment
  * lmapd: use twampc -r1 for simet.nic.br_twampc

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 11 Nov 2019 09:25:26 -0300

simet-ma (0.15.1) unstable; urgency=medium

  * simet-ma version 0.15.1
  * control: depend on simet-lmapd version 0.13.3 or newer, for
    the ma-report-result-event-time report fix
  * lmapd: expose simet.nic.br_twampc for SIMET-AS use
  * twampc: remove the dead "-d device_id" parameter
  * lmap report helpers: render reports in UTC

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 08 Nov 2019 12:51:24 -0300

simet-ma (0.15.0) unstable; urgency=medium

  * simet-ma version 0.15.0
  * add a "production" version of the simet-ma running in a docker
    container

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 29 Oct 2019 14:54:34 -0300

simet-ma (0.14.6) unstable; urgency=medium

  * simet-ma version 0.14.6
  * fix registration of an MA that is paired (/var/run/simet might
    not exist in some MAs at the time simet_register_ma first runs.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 29 Oct 2019 11:09:29 -0300

simet-ma (0.14.5) unstable; urgency=medium

  * simet-ma version 0.14.5
  * fix TWAMP reports which were returning truncated timestamp data
  * (openwrt-only): use md5sum to compare files instead of sha256sum,
    this is cheaper and does not require busybox config changes in
    older openwrt.

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Mon, 07 Oct 2019 13:56:13 -0300

simet-ma (0.14.4) unstable; urgency=medium

  * simet-ma version 0.14.3, 0.14.4
  * brown-paperbag fix for incorrect tasklet config.d json generation that
    broke the hardcoded lmap default config
  * simet-api, simet-runner: add some lmap metadata tags in reports that
    were missing (engine-name,version;task-version)

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 13 Aug 2019 14:22:39 -0300

simet-ma (0.14.2) unstable; urgency=medium

  * simet-ma version 0.14.2
  * postinst: call simet_create_vlabel.sh to generate the MA
    virtual label when one does not exist yet, and log it to
    stderr and syslog (via "logger")

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 08 Aug 2019 15:37:28 -0300

simet-ma (0.14.1) unstable; urgency=medium

  * simet-ma version 0.14.1
  * simet_register_ma: create etc/simet/lmap dir if missing

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 02 Aug 2019 16:50:48 -0300

simet-ma (0.14.0) unstable; urgency=medium

  * simet-ma version 0.14.0
  * switch to the new agent register API
  * add support for virtual labels
  * auto-update: update all simet packages (e.g. simet-lmapd)
  * tcpbw: default to IPv6
  * twamp: handle (a limited number of) dup packets without aborting
  * several lmap metadata updates
  * recommend diagnostic tools extended tests might use
    fping, traceroute, ping, nslookup, dig/drill
  * recommend iw, iproute2 for geolocation using wifi
  * handle Debian Jessie's lack of logger --no-act

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 01 Aug 2019 16:20:23 -0300

simet-ma (0.13.2) unstable; urgency=medium

  * simet-ma version 0.13.2
  * New simet_geolocation.sh, simet.nic.br_geolocation LMAP handling
  * Several fixes to the generic stdout LMAP tasklets

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 25 Apr 2019 11:48:11 -0300

simet-ma (0.13.1) unstable; urgency=medium

  * simet-ma version 0.13.1
  * Sync debian/copyright with COPYING

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Thu, 11 Apr 2019 16:15:20 -0300

simet-ma (0.13.0) unstable; urgency=medium

  * simet-ma version 0.13.0
  * simet-lmapd integration:
    Agent-info handling, many lmap-controller related fixes
    and enhancements.  Requires simet-lmapd 0.13.0 or later
  * docker: add rsyslog and a few improvements to the simet-ma
    example "container-based measurement agent"
  * deb packages: start-stop-daemon fixes

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Tue, 09 Apr 2019 12:34:21 -0300

simet-ma (0.12.0) unstable; urgency=medium

  * simet-ma version 0.12.0
  * simet-lmapd integration:
    Downloads schedule from controller, exports state to controller
    Requires simet-lmapd 0.12.0 or later

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Wed, 27 Mar 2019 09:22:30 -0300

simet-ma (0.9.3) unstable; urgency=medium

  * simet-ma version 0.9.3

 -- NIC.br SIMET Team <medicoes@simet.nic.br>  Fri, 15 Mar 2019 13:43:07 -0300
